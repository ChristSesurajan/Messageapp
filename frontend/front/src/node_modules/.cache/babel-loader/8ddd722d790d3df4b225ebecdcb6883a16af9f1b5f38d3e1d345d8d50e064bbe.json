{"ast":null,"code":"import React,{useContext,useState,useEffect}from'react';import API_ENDPOINT from'./../api/index.js';import{UserContext}from'./../context/UserContext';import{useNavigate}from'react-router-dom';import{rid}from'./searchus.js';import'./searchus.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function Message(){const[messages,setMessages]=useState([]);const[newMessage,setNewMessage]=useState('');const[error,setError]=useState('');let[senderId,setSenderId]=useState();// Initialize as null\nconst[selectedUserId,setSelectedUserId]=useState(0);const{username}=useContext(UserContext);const navigate=useNavigate();useEffect(()=>{if(username){fetchUserId();}},[username]);useEffect(()=>{if(senderId&&rid){fetchMessages();}},[senderId,rid]);const fetchMessages=async()=>{try{// console.log(senderId);\n//console.log(rid);\nconst response=await fetch(\"\".concat(API_ENDPOINT,\"/messages?sender_id=\").concat(senderId,\"&recipient_id=\").concat(rid));const data=await response.json();// console.log(data);\nsetMessages(data.messages);}catch(error){// console.error('Error fetching messages:', error);\nsetError(error.message);}};const fetchUserId=async()=>{try{const response=await fetch(\"\".concat(API_ENDPOINT,\"/messages?username=\").concat(username));if(!response.ok){throw new Error('Failed to fetch user ID');}const data=await response.json();// console.log('Fetched User ID:', data.user.id);\nsetSenderId(data.user.id);}catch(error){//  console.error('Error fetching user ID:', error);\nsetError(error.message);}};const sendMessage=async()=>{//  console.log(senderId)\nif(!senderId||!newMessage){setError('Sender ID and message are required');return;}try{const response=await fetch(\"\".concat(API_ENDPOINT,\"/messages\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({sender_id:senderId,recipient_id:rid,message:newMessage})});if(!response.ok){throw new Error('Failed to send message');}setNewMessage('');fetchMessages();}catch(error){console.error('Error sending message:',error);setError(error.message);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"messaging-app-container\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"app-title\",children:\"Messaging App\"}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"error\",children:error}),/*#__PURE__*/_jsxs(\"div\",{className:\"message-input-container\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:newMessage,onChange:e=>setNewMessage(e.target.value),className:\"message-input\",placeholder:\"Type a message...\"}),/*#__PURE__*/_jsx(\"button\",{onClick:sendMessage,className:\"send-button\",children:\"Send\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"message-list\",children:/*#__PURE__*/_jsx(\"ul\",{children:[...messages].reverse().map((message,index)=>/*#__PURE__*/_jsx(\"li\",{className:\"message \".concat(message.sender_id===senderId?'sent':'received'),children:message.message},index))})})]});}export default Message;","map":{"version":3,"names":["React","useContext","useState","useEffect","API_ENDPOINT","UserContext","useNavigate","rid","jsx","_jsx","jsxs","_jsxs","Message","messages","setMessages","newMessage","setNewMessage","error","setError","senderId","setSenderId","selectedUserId","setSelectedUserId","username","navigate","fetchUserId","fetchMessages","response","fetch","concat","data","json","message","ok","Error","user","id","sendMessage","method","headers","body","JSON","stringify","sender_id","recipient_id","console","className","children","type","value","onChange","e","target","placeholder","onClick","reverse","map","index"],"sources":["D:/visualcode/myapp/frontend/front/src/api/messageap.js"],"sourcesContent":["import React, { useContext, useState, useEffect } from 'react';\r\nimport API_ENDPOINT from './../api/index.js';\r\nimport { UserContext } from './../context/UserContext';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { rid } from './searchus.js';\r\nimport './searchus.css';\r\n\r\nfunction Message() {\r\n  const [messages, setMessages] = useState([]);\r\n  const [newMessage, setNewMessage] = useState('');\r\n  const [error, setError] = useState('');\r\n  let [senderId, setSenderId] = useState(); // Initialize as null\r\n  const [selectedUserId, setSelectedUserId] = useState(0);\r\n  const { username } = useContext(UserContext);\r\n  const navigate = useNavigate();\r\n\r\n  useEffect(() => {\r\n    if (username) {\r\n      fetchUserId();\r\n    }\r\n  }, [username]);\r\n  \r\n  useEffect(() => {\r\n    if (senderId && rid) {\r\n      fetchMessages();\r\n    }\r\n  }, [senderId, rid]);\r\n  \r\n  const fetchMessages = async () => {\r\n    try {\r\n     // console.log(senderId);\r\n      //console.log(rid);\r\n      const response = await fetch(`${API_ENDPOINT}/messages?sender_id=${senderId}&recipient_id=${rid}`);\r\n      const data = await response.json();\r\n     // console.log(data);\r\n      setMessages(data.messages);\r\n    } catch (error) {\r\n     // console.error('Error fetching messages:', error);\r\n      setError(error.message);\r\n    }\r\n  };\r\n  \r\n  const fetchUserId = async () => {\r\n    try {\r\n      const response = await fetch(`${API_ENDPOINT}/messages?username=${username}`);\r\n      if (!response.ok) {\r\n        throw new Error('Failed to fetch user ID');\r\n      }\r\n      const data = await response.json();\r\n     // console.log('Fetched User ID:', data.user.id);\r\n      setSenderId(data.user.id);\r\n    } catch (error) {\r\n    //  console.error('Error fetching user ID:', error);\r\n      setError(error.message);\r\n    }\r\n  };\r\n\r\n\r\n\r\n  const sendMessage = async () => {\r\n    //  console.log(senderId)\r\n    if (!senderId || !newMessage) {\r\n      setError('Sender ID and message are required');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(`${API_ENDPOINT}/messages`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({ sender_id: senderId, recipient_id: rid, message: newMessage }),\r\n      });\r\n      if (!response.ok) {\r\n        throw new Error('Failed to send message');\r\n      }\r\n      setNewMessage('');\r\n      fetchMessages();\r\n    } catch (error) {\r\n      console.error('Error sending message:', error);\r\n      setError(error.message);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"messaging-app-container\">\r\n      <h1 className=\"app-title\">Messaging App</h1>\r\n      {error && <div className=\"error\">{error}</div>}\r\n      <div className=\"message-input-container\">\r\n        <input\r\n          type=\"text\"\r\n          value={newMessage}\r\n          onChange={(e) => setNewMessage(e.target.value)}\r\n          className=\"message-input\"\r\n          placeholder=\"Type a message...\"\r\n        />\r\n        <button onClick={sendMessage} className=\"send-button\">\r\n          Send\r\n        </button>\r\n      </div>\r\n      <div className=\"message-list\">\r\n        <ul>\r\n          {[...messages].reverse().map((message, index) => (\r\n            <li\r\n              key={index}\r\n              className={`message ${message.sender_id === senderId ? 'sent' : 'received'}`}\r\n            >\r\n              {message.message}\r\n            </li>\r\n          ))}\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Message;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}